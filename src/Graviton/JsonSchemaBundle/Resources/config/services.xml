<?xml version="1.0"?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <parameters>
        <parameter key="graviton.jsonschema.schema.factory.class">Graviton\JsonSchemaBundle\Schema\SchemaFactory</parameter>
        <parameter key="graviton.jsonschema.schema.resolver.class">JsonSchema\RefResolver</parameter>

        <parameter key="graviton.jsonschema.resolver.uri_retriever.class">JsonSchema\Uri\UriRetriever</parameter>
        <parameter key="graviton.jsonschema.resolver.uri_resolver.class">JsonSchema\Uri\UriResolver</parameter>

        <parameter key="graviton.jsonschema.schema.uri"/>

        <parameter key="graviton.jsonschema.validator.class">Graviton\JsonSchemaBundle\Validator\Validator</parameter>
        <parameter key="graviton.jsonschema.validator.validator.class">JsonSchema\Validator</parameter>
    </parameters>

    <services>
        <!-- schema -->
        <service id="graviton.jsonschema.schema.resolver"
                 class="%graviton.jsonschema.schema.resolver.class%"
                 public="false">
            <argument type="service" id="graviton.jsonschema.schema.resolver.uri_retriever"/>
            <argument type="service" id="graviton.jsonschema.schema.resolver.uri_resolver"/>
        </service>
        <service id="graviton.jsonschema.schema.resolver.uri_resolver"
                 class="%graviton.jsonschema.resolver.uri_resolver.class%"
                 public="false">
        </service>
        <service id="graviton.jsonschema.schema.resolver.uri_retriever"
                 class="%graviton.jsonschema.resolver.uri_retriever.class%"
                 public="false">
        </service>

        <service id="graviton.jsonschema.schema.factory"
                 class="%graviton.jsonschema.schema.factory.class%"
                 public="false">
            <argument type="service" id="graviton.jsonschema.schema.resolver"/>
        </service>
        <service id="graviton.jsonschema.schema.data"
            class="stdClass">
            <factory service="graviton.jsonschema.schema.factory" method="createSchema"/>
            <argument>%graviton.jsonschema.schema.uri%</argument>
        </service>

        <!-- validator -->
        <service id="graviton.jsonschema.validator"
                 class="%graviton.jsonschema.validator.class%">
            <argument type="service" id="graviton.jsonschema.validator.validator"/>
            <argument type="service" id="graviton.jsonschema.schema.data"/>
        </service>
        <!-- subvalidator (what we wrap) -->
        <service id="graviton.jsonschema.validator.validator"
                 class="%graviton.jsonschema.validator.validator.class%">
        </service>

        <!-- commands -->
        <service id="graviton.jsonschema.command.validatedefinition.abstract"
                 abstract="true">
            <call method="setValidator">
                <argument type="service" id="graviton.jsonschema.validator"/>
            </call>
        </service>
        <service id="graviton.jsonschema.command.validatedefinition.directory"
                 class="Graviton\JsonSchemaBundle\Command\ValidateDirectoryCommand"
                 parent="graviton.jsonschema.command.validatedefinition.abstract">
            <call method="setDefaultPath">
                <argument>%kernel.root_dir%/..</argument>
            </call>
            <tag name="console.command"/>
        </service>
        <service id="graviton.jsonschema.command.validatedefinition.file"
                 class="Graviton\JsonSchemaBundle\Command\ValidateFileCommand"
                 parent="graviton.jsonschema.command.validatedefinition.abstract">
            <tag name="console.command"/>
        </service>
    </services>
</container>
